<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    :root {
      --bg-light: #f0f2f5;
      --bg-card: #ffffffcc;
      --text-light: #212529;
      --primary: #6C63FF;
      --accent: #FFB800;
      --success: #28a745;
      --danger: #dc3545;
    }
    [data-theme="dark"] {
      --bg-light: #121416;
      --bg-card: #1e1f23;
      --text-light: #e1e2e5;
    }
    body {
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background .3s, color .3s;
    }
    .navbar, .expense-card {
      background-color: var(--bg-card) !important;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .btn-animated {
      transition: transform .2s, box-shadow .2s;
    }
    .btn-animated:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .filter-panel input,
    .filter-panel select {
      max-width: 200px;
    }
    .budget-alert {
      position: fixed; bottom: 1rem; right: 1rem; z-index: 1055;
    }
    ::-webkit-scrollbar {
      width: 8px;
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: var(--primary);
      border-radius: 4px;
    }
  </style>
</head>
<body>
  
  <nav class="navbar navbar-expand-lg mb-4 px-4">
    <a class="navbar-brand text-primary fw-bold" href="#">
      <i class="bi bi-wallet2"></i> Expense Tracker
    </a>
    <div class="ms-auto d-flex align-items-center">
      <div class="form-check form-switch me-3">
        <input class="form-check-input" type="checkbox" id="darkModeToggle">
        <label class="form-check-label" for="darkModeToggle">
          <i id="themeIcon" class="bi bi-moon-fill"></i>
        </label>
      </div>
      <button class="btn btn-outline-secondary btn-sm btn-animated" id="settingsBtn">
        <i class="bi bi-gear-fill"></i>
      </button>
    </div>
  </nav>

  <div class="container">
    
    <div class="row mb-3 filter-panel gx-2 gy-2">
      <div class="col-auto">
        <input type="date" id="filterStart" class="form-control" placeholder="From"/>
      </div>
      <div class="col-auto">
        <input type="date" id="filterEnd" class="form-control" placeholder="To"/>
      </div>
      <div class="col-auto">
        <select id="filterCategory" class="form-select">
          <option value="">All Categories</option>
        </select>
      </div>
      <div class="col-auto">
        <input type="text" id="filterSearch" class="form-control" placeholder="Search…"/>
      </div>
      <div class="col-auto">
        <button class="btn btn-primary btn-animated" id="applyFilter">
          <i class="bi bi-funnel-fill"></i> Filter
        </button>
      </div>
    </div>

 
    <div class="row gy-3 mb-4">
      <div class="col-sm-6 col-lg-3">
        <div class="expense-card p-3 text-center">
          <div class="text-secondary">Total Spent</div>
          <div class="h2 text-primary" id="totalSpent">₹0.00</div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3">
        <div class="expense-card p-3 text-center">
          <div class="text-secondary">This Month</div>
          <div class="h2 text-success" id="monthTotal">₹0.00</div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3">
        <div class="expense-card p-3 text-center">
          <div class="text-secondary">This Year</div>
          <div class="h2 text-accent" id="yearTotal">₹0.00</div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3 text-center">
        <button class="btn btn-primary btn-animated py-3 w-100" data-bs-toggle="modal" data-bs-target="#addExpenseModal">
          <i class="bi bi-plus-circle me-1"></i> Add Expense
        </button>
      </div>
    </div>

  
    <div class="expense-card p-3 mb-4">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th><th>Description</th><th>Date</th>
              <th>Category</th><th>Amount</th><th>Recurring</th><th>Action</th>
            </tr>
          </thead>
          <tbody id="expenseTableBody"></tbody>
        </table>
      </div>
    </div>

    
    <div class="expense-card p-3 mb-4 text-center">
      <canvas id="categoryChart" style="max-height:300px;"></canvas>
    </div>
  </div>

  
  <div class="modal fade" id="addExpenseModal" tabindex="-1">
    <div class="modal-dialog">
      <form id="expenseForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add / Edit Expense</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editIndex"/>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <input type="text" id="desc" class="form-control" maxlength="50" required/>
          </div>
          <div class="mb-3">
            <label class="form-label">Date</label>
            <input type="date" id="date" class="form-control" required/>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select id="category" class="form-select" required></select>
          </div>
          <div class="mb-3">
            <label class="form-label">Amount (₹)</label>
            <input type="number" id="amount" class="form-control" min="0.01" step="0.01" required/>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="recurring"/>
            <label class="form-check-label" for="recurring">Recurring Monthly</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary btn-animated" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary btn-animated">Save</button>
        </div>
      </form>
    </div>
  </div>

 
  <div class="modal fade" id="settingsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <form id="settingsForm" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Settings</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">User Name</label>
            <input type="text" id="userName" class="form-control"/>
          </div>
          <div class="mb-3">
            <label class="form-label">Currency Symbol</label>
            <input type="text" id="currency" class="form-control" maxlength="3" value="₹"/>
          </div>
          <div class="mb-3">
            <label class="form-label">Monthly Budget Alert (₹)</label>
            <input type="number" id="budget" class="form-control" min="0"/>
          </div>
          <div class="mb-3">
            <label class="form-label">Export / Import Data</label>
            <div class="d-flex">
              <button id="exportCsv" class="btn btn-outline-primary btn-animated me-2">Export CSV</button>
              <input type="file" id="importCsv" class="form-control"/>
            </div>
          </div>
          <button type="button" id="resetData" class="btn btn-danger btn-sm w-100">Reset All Data</button>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary btn-animated" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary btn-animated">Save Settings</button>
        </div>
      </form>
    </div>
  </div>

  <div id="budgetAlert" class="toast budget-alert align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">Budget exceeded!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>

 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    
    const categories = [
      {name:'Food',color:'#ff6b6b',icon:'bi-cup-straw'},
      {name:'Transport',color:'#4ecdc4',icon:'bi-car-front'},
      {name:'Shopping',color:'#45b7d1',icon:'bi-bag-check'},
      {name:'Bills',color:'#ffa502',icon:'bi-receipt'},
      {name:'Entertainment',color:'#ffb8b0',icon:'bi-controller'},
      {name:'Health',color:'#3F72AF',icon:'bi-heart-pulse'},
      {name:'Others',color:'#7f8fa6',icon:'bi-three-dots'},
    ];

   
    let expenses = JSON.parse(localStorage.getItem('exp_data'))||[];
    let settings = JSON.parse(localStorage.getItem('exp_settings'))||{user:'',currency:'₹',budget:0};
    let chart;

    document.addEventListener('DOMContentLoaded',()=>{
   
      const catElems = document.querySelectorAll('#filterCategory, #category');
      categories.forEach(c=>{
        catElems.forEach(sel=>{
          sel.innerHTML += `<option value="${c.name}">${c.name}</option>`;
        });
      });
      
      document.getElementById('userName').value = settings.user;
      document.getElementById('currency').value = settings.currency;
      document.getElementById('budget').value = settings.budget;
      document.querySelector('title').textContent = `${settings.user||'User'} | Expense Tracker`;
    
      if(localStorage.getItem('theme')==='dark'){
        document.documentElement.setAttribute('data-theme','dark');
        document.getElementById('darkModeToggle').checked=true;
        document.getElementById('themeIcon').className='bi bi-sun-fill';
      }
     
      renderAll();
    });

 
    document.getElementById('darkModeToggle').addEventListener('change', e=>{
      if(e.target.checked){
        document.documentElement.setAttribute('data-theme','dark');
        document.getElementById('themeIcon').className='bi bi-sun-fill';
        localStorage.setItem('theme','dark');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.getElementById('themeIcon').className='bi bi-moon-fill';
        localStorage.setItem('theme','light');
      }
    });

  
    document.getElementById('expenseForm').addEventListener('submit',e=>{
      e.preventDefault();
      const i = document.getElementById('editIndex').value;
      const obj = {
        description:desc.value, date:date.value,
        category:category.value, amount:parseFloat(amount.value),
        recurring:recurring.checked
      };
      if(i==='') expenses.push(obj);
      else expenses[i]=obj;
      localStorage.setItem('exp_data',JSON.stringify(expenses));
      bootstrap.Modal.getInstance(addExpenseModal).hide();
      e.target.reset(); document.getElementById('editIndex').value='';
      renderAll();
    });

    
    window.deleteExpense = idx=>{
      if(confirm('Delete this expense?')){
        expenses.splice(idx,1);
        localStorage.setItem('exp_data',JSON.stringify(expenses));
        renderAll();
      }
    };
    window.editExpense = idx=>{
      const e = expenses[idx];
      desc.value=e.description; date.value=e.date;
      category.value=e.category; amount.value=e.amount;
      recurring.checked=e.recurring;
      editIndex.value=idx;
      new bootstrap.Modal(addExpenseModal).show();
    };

 
    applyFilter.addEventListener('click',()=> renderAll());

    settingsBtn.addEventListener('click',()=> new bootstrap.Modal(settingsModal).show());
    document.getElementById('settingsForm').addEventListener('submit',e=>{
      e.preventDefault();
      settings.user=userName.value; settings.currency=currency.value;
      settings.budget=parseFloat(budget.value)||0;
      localStorage.setItem('exp_settings',JSON.stringify(settings));
      renderAll(); bootstrap.Modal.getInstance(settingsModal).hide();
    });
   
    exportCsv.addEventListener('click',()=>{
      const csv = ['Description,Date,Category,Amount,Recurring']
        .concat(expenses.map(e=>`${e.description},${e.date},${e.category},${e.amount},${e.recurring}`))
        .join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='expenses.csv';
      a.click(); URL.revokeObjectURL(url);
    });
   
    importCsv.addEventListener('change',e=>{
      const file=e.target.files[0];
      if(!file) return;
      const reader=new FileReader();
      reader.onload=()=> {
        const lines=reader.result.trim().split('\n').slice(1);
        expenses=lines.map(l=>{
          const [d,dt,c,a,r]=l.split(',');
          return {description:d,date:dt,category:c,amount:parseFloat(a),recurring:r==='true'};
        });
        localStorage.setItem('exp_data',JSON.stringify(expenses));
        renderAll();
      };
      reader.readAsText(file);
    });
  
    resetData.addEventListener('click',()=>{
      if(confirm('Erase ALL data?')){
        localStorage.clear(); expenses=[]; settings={currency:'₹',budget:0};
        renderAll();
      }
    });

   
    function renderAll(){
      renderTable();
      renderSummary();
      renderChart();
      checkBudget();
    }


    function renderTable(){
      const tbody=expenseTableBody; tbody.innerHTML='';
      const filtered = expenses.filter(e=>{
        const s=filterStart.value||'0000-01-01', t=filterEnd.value||'9999-12-31';
        const hasDate = e.date>=s && e.date<=t;
        const hasCat = !filterCategory.value || e.category===filterCategory.value;
        const hasText = !filterSearch.value || e.description.toLowerCase().includes(filterSearch.value.toLowerCase());
        return hasDate && hasCat && hasText;
      });
      filtered.forEach((e,i)=>{
        const cat=categories.find(c=>c.name===e.category);
        tbody.innerHTML+=`
          <tr>
            <td>${i+1}</td>
            <td>${e.description}</td>
            <td>${e.date}</td>
            <td>
              <span class="badge" style="background:${cat.color};color:#fff">
                <i class="bi ${cat.icon}"></i> ${cat.name}
              </span>
            </td>
            <td>${settings.currency}${e.amount.toFixed(2)}</td>
            <td>${e.recurring?'✔':'—'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editExpense(${i})">
                <i class="bi bi-pencil-fill"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteExpense(${i})">
                <i class="bi bi-trash-fill"></i>
              </button>
            </td>
          </tr>`;
      });
    }

   
    function renderSummary(){
      const total=expenses.reduce((s,e)=>s+e.amount,0);
      totalSpent.textContent=`${settings.currency}${total.toFixed(2)}`;
      const now=new Date();
      const thisMonth = expenses
        .filter(e=>e.date.slice(0,7)===now.toISOString().slice(0,7))
        .reduce((s,e)=>s+e.amount,0);
      monthTotal.textContent=`${settings.currency}${thisMonth.toFixed(2)}`;
      const thisYear = expenses
        .filter(e=>e.date.slice(0,4)===now.getFullYear().toString())
        .reduce((s,e)=>s+e.amount,0);
      yearTotal.textContent=`${settings.currency}${thisYear.toFixed(2)}`;
    }


    function renderChart(){
      const totals = categories.map(c=> 
        expenses.filter(e=>e.category===c.name)
                .reduce((s,e)=>s+e.amount,0)
      );
      if(chart) chart.destroy();
      chart = new Chart(categoryChart, {
        type:'doughnut',
        data:{
          labels:categories.map(c=>c.name),
          datasets:[{
            data:totals,
            backgroundColor:categories.map(c=>c.color),
            borderWidth:1
          }]
        },
        options:{cutout:'60%',plugins:{legend:{position:'bottom'}}}
      });
    }

    function checkBudget(){
      if(settings.budget>0 && parseFloat(monthTotal.textContent.slice(1))>settings.budget){
        new bootstrap.Toast(budgetAlert).show();
      }
    }

   
    window.addEventListener('load',()=>{
      const today=new Date().toISOString().slice(0,10);
      expenses.forEach(e=>{
        if(e.recurring && !expenses.some(x=>x.description===e.description && x.date===today)){
          expenses.push({...e,date:today});
        }
      });
      localStorage.setItem('exp_data',JSON.stringify(expenses));
      renderAll();
    });
  </script>
</body>
</html>
